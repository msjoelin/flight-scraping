---
title: "Flight Price Web Scraping"
author: "Marcus"
date: "February 14, 2019"
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Flight Web Scraping

I'm traveling very frequently, and this includes searching for flights. Price is of course one important factor when deciding in the decision process, and I guess that most of us have noticed the fluctuations in flight prices. It happened that I searched for a flight, the price looked good, but didnt book the flight. The next day, the price had doubled (at least it felt like that). 

To take a closer look at this without having to search for flights every day, I wrote an R-script to scrape the data. As some sites are making it hard to scrape the data (with recaptcha or homepages where the elements arent that hard to scrape), the first step was to identify a flight search engines where the scraping could be performed without too much of effort. Expedia turned out to be an "easy" site to scrape. 


```{r,  message=FALSE, warning=FALSE}
library(readr)      # Read data in data 
library(lubridate)  # Date handling
library(stringr)    # Text handling

library(tidyr)      # Data cleaning
library(dplyr)      # Data cleaning

library(ggplot2)    # Visualization

df <- read.csv("flightdata.csv", stringsAsFactors = TRUE)

head(df)
```

As it seems, some days the scraping wasnt done fully. 

```{r,  echo=FALSE}
ggplot(df, aes(x=ScrapeDate, y=Journey, color=Origin))+
  geom_point() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Including Plots

You can also embed plots, for example:

```{r, echo=FALSE}
# 1: check stdeviation per trip

group_by(df, Journey, Origin, TravelDates) %>%
  summarize(std=sd(price),
            n=n()) %>%
  mutate(std_stand = scale(std)) %>%
  filter(n>=3) %>%
  ggplot(aes(x=Journey, y=std_stand, color=Origin)) +
  geom_point(alpha=0.2) +
  geom_boxplot() +
  geom_hline(yintercept=0) + 
  coord_flip(ylim=c(-5,5)) 

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
